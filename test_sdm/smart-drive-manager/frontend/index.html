<!-- index.html - Main Dashboard -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Drive Manager - Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script>
        // API Base URL Configuration
        window.__API_BASE__ = (() => {
            const hostname = window.location.hostname;
            const isDev = hostname === 'localhost' || hostname === '127.0.0.1';

            if (isDev) {
                return 'http://localhost:8080/api';
            } else {
                return `https://${hostname}/api`;
            }
        })();

        console.log('üì° API Base URL configured:', window.__API_BASE__);

        // WebSocket Base URL Configuration
        window.__WS_BASE__ = (() => {
            const hostname = window.location.hostname;
            const isDev = hostname === 'localhost' || hostname === '127.0.0.1';

            if (isDev) {
                return 'ws://localhost:8081';
            } else {
                return `wss://${hostname}/ws`;
            }
        })();

        console.log('üåê WebSocket URL configured:', window.__WS_BASE__);
    </script>

    <script>
        // ‚úÖ FIXED: Proper authentication check BEFORE any initialization
        (function () {
            console.log('üîê Checking authentication...');

            const sessionId = localStorage.getItem('session_id');
            const userData = localStorage.getItem('user_data');

            // ‚úÖ FIX 1: More strict authentication check
            if (!sessionId || !userData) {
                console.log('‚ùå No valid session found, redirecting to login...');
                // Clear any partial data
                localStorage.clear();
                window.location.replace('/login.html');
                return;
            }

            // ‚úÖ FIX 2: Validate session data format
            try {
                const parsedUserData = JSON.parse(userData);
                if (!parsedUserData.driver_id || !parsedUserData.username) {
                    console.log('‚ùå Invalid user data format, redirecting to login...');
                    localStorage.clear();
                    window.location.replace('/login.html');
                    return;
                }
                console.log('‚úÖ Authentication valid:', parsedUserData.username);
            } catch (e) {
                console.log('‚ùå Corrupted user data, redirecting to login...');
                localStorage.clear();
                window.location.replace('/login.html');
                return;
            }
        })();
    </script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-car"></i>
                    <span>Smart Drive</span>
                </div>
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="user-profile">
                <div class="avatar" id="userAvatar">MB</div>
                <div class="user-info">
                    <h3 id="userName">Mubeen Butt</h3>
                    <p id="userRole">Administrator</p>
                    <p id="userScore">Safety Score: <span>920</span>/1000</p>
                </div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="trips">
                    <i class="fas fa-route"></i>
                    <span>Trip Management</span>
                </li>
                <li class="nav-item" data-page="vehicles">
                    <i class="fas fa-car-side"></i>
                    <span>Vehicle Management</span>
                </li>
                <li class="nav-item" data-page="expenses">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Expense Tracking</span>
                </li>
                <li class="nav-item" data-page="drivers">
                    <i class="fas fa-user-circle"></i>
                    <span>Driver Profiles</span>
                </li>
                <li class="nav-item" data-page="incidents">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Incidents</span>
                </li>
                <li class="nav-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                </li>
                <li class="nav-item" data-page="camera">
                    <i class="fas fa-video"></i>
                    <span>Vision System</span>
                </li>
                <li class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </li>
            </ul>

            <div class="sidebar-footer">
                <div class="server-status">
                    <div class="status-dot" id="wsStatusDot"></div>
                    <span>Backend: <strong id="wsStatus">Disconnected</strong></span>
                </div>
                <button class="btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="page-title">
                    <h1 id="pageTitle">Dashboard</h1>
                    <p id="pageSubtitle">Real-time monitoring and control</p>
                </div>

                <div class="quick-stats">
                    <div class="stat-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <div>
                            <span class="stat-value" id="liveSpeed">0</span>
                            <span class="stat-label">km/h</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-bolt"></i>
                        <div>
                            <span class="stat-value" id="liveAccel">0.0</span>
                            <span class="stat-label">m/s¬≤</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <span class="stat-value" id="liveSafety">920</span>
                            <span class="stat-label">Score</span>
                        </div>
                    </div>
                    <div class="stat-item trip-status">
                        <i class="fas fa-play-circle"></i>
                        <div>
                            <span class="stat-label">Trip Status</span>
                            <span class="stat-value" id="tripStatus">Inactive</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area (Will be dynamically loaded) -->
            <div class="content-area" id="contentArea">
                <!-- Dashboard content will be loaded here -->
            </div>
        </main>

        <!-- Alerts Panel -->
        <aside class="alerts-panel">
            <div class="alerts-header">
                <h3><i class="fas fa-bell"></i> Alerts & Notifications</h3>
                <button class="btn-clear" onclick="clearAlerts()">Clear All</button>
            </div>
            <div class="alerts-list" id="alertsContainer">
                <div class="alert-item success">
                    <i class="fas fa-check-circle"></i>
                    <div class="alert-content">
                        <strong>System Ready</strong>
                        <p>Smart Drive Manager is running</p>
                    </div>
                    <span class="alert-time">Just now</span>
                </div>
            </div>
        </aside>
    </div>

    <!-- Page Templates (Hidden) -->

    <div id="pageTemplates" style="display: none;">
        <!-- Add these to the #pageTemplates section in index.html -->

        <!-- Analytics & Reports Template -->
        <div id="reportsTemplate">
            <div class="page-header">
                <h2><i class="fas fa-chart-bar"></i> Analytics & Reports</h2>
                <p>Comprehensive analytics and detailed reports</p>
            </div>

            <div class="reports-controls">
                <div class="btn-group">
                    <button class="btn btn-primary"
                        onclick="if(window.analytics) window.analytics.generateReport('daily')">
                        <i class="fas fa-calendar-day"></i> Daily Report
                    </button>
                    <button class="btn btn-primary"
                        onclick="if(window.analytics) window.analytics.generateReport('weekly')">
                        <i class="fas fa-calendar-week"></i> Weekly Report
                    </button>
                    <button class="btn btn-primary"
                        onclick="if(window.analytics) window.analytics.generateReport('monthly')">
                        <i class="fas fa-calendar-alt"></i> Monthly Report
                    </button>
                    <button class="btn btn-success"
                        onclick="if(window.analytics) window.analytics.exportReport('Report')">
                        <i class="fas fa-file-export"></i> Export Data
                    </button>
                </div>

                <div class="date-range">
                    <input type="date" id="reportStartDate" class="form-control">
                    <span>to</span>
                    <input type="date" id="reportEndDate" class="form-control">
                    <button class="btn btn-secondary" onclick="if(window.analytics) window.analytics.updateCharts()">
                        <i class="fas fa-filter"></i> Filter
                    </button>
                </div>
            </div>

            <div class="reports-grid">
                <div class="card card-wide">
                    <div class="card-header">
                        <h3>Performance Overview</h3>
                        <div class="card-actions">
                            <select id="performancePeriod" class="form-select-sm"
                                onchange="if(window.analytics) window.analytics.updatePerformanceChart()">
                                <option value="7">Last 7 Days</option>
                                <option value="30">Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="365">Last Year</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="performanceChart" width="800" height="300"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Safety Score Trend</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="safetyChart" width="400" height="200"></canvas>
                        <div class="chart-stats">
                            <div class="stat">
                                <span class="label">Current Score:</span>
                                <span class="value" id="currentSafetyScore">920</span>
                            </div>
                            <div class="stat">
                                <span class="label">Trend:</span>
                                <span class="value positive">+5.2%</span>
                            </div>
                            <div class="stat">
                                <span class="label">Fleet Average:</span>
                                <span class="value">845</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Fuel Efficiency</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="fuelChart" width="400" height="200"></canvas>
                        <div class="chart-stats">
                            <div class="stat">
                                <span class="label">Current:</span>
                                <span class="value">12.5 km/L</span>
                            </div>
                            <div class="stat">
                                <span class="label">Best:</span>
                                <span class="value">14.2 km/L</span>
                            </div>
                            <div class="stat">
                                <span class="label">Cost/km:</span>
                                <span class="value">$0.15</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card card-wide">
                    <div class="card-header">
                        <h3>Detailed Metrics</h3>
                    </div>
                    <div class="card-body">
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-header">
                                    <i class="fas fa-route"></i>
                                    <h4>Trip Analysis</h4>
                                </div>
                                <div class="metric-body">
                                    <div class="metric-item">
                                        <span>Average Trip Distance:</span>
                                        <strong id="avgTripDistance">41.7 km</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Average Trip Duration:</span>
                                        <strong id="avgTripDuration">48 min</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Peak Driving Time:</span>
                                        <strong id="peakDrivingTime">08:00-10:00</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Most Frequent Route:</span>
                                        <strong id="frequentRoute">Office - Home</strong>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card">
                                <div class="metric-header">
                                    <i class="fas fa-car-crash"></i>
                                    <h4>Safety Metrics</h4>
                                </div>
                                <div class="metric-body">
                                    <div class="metric-item">
                                        <span>Harsh Braking/100km:</span>
                                        <strong id="harshBrakingRate">1.2</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Rapid Acceleration/100km:</span>
                                        <strong id="rapidAccelRate">0.8</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Speeding Incidents:</span>
                                        <strong id="speedingIncidents">3</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Lane Departures:</span>
                                        <strong id="laneDepartures">5</strong>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card">
                                <div class="metric-header">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <h4>Cost Analysis</h4>
                                </div>
                                <div class="metric-body">
                                    <div class="metric-item">
                                        <span>Daily Cost:</span>
                                        <strong id="dailyCost">$18.50</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Monthly Cost:</span>
                                        <strong id="monthlyCost">$555.00</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Cost per km:</span>
                                        <strong id="costPerKm">$0.15</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Fuel Efficiency:</span>
                                        <strong id="fuelEfficiency">12.5 km/L</strong>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card">
                                <div class="metric-header">
                                    <i class="fas fa-clock"></i>
                                    <h4>Time Analysis</h4>
                                </div>
                                <div class="metric-body">
                                    <div class="metric-item">
                                        <span>Total Drive Time:</span>
                                        <strong id="totalDriveTime">156 hours</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Average Speed:</span>
                                        <strong id="averageSpeed">58.4 km/h</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Idle Time:</span>
                                        <strong id="idleTime">12.5 hours</strong>
                                    </div>
                                    <div class="metric-item">
                                        <span>Night Driving:</span>
                                        <strong id="nightDriving">8%</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Vehicle Comparison</h3>
                    </div>
                    <div class="card-body">
                        <table class="data-table" id="vehicleComparisonTable">
                            <thead>
                                <tr>
                                    <th>Vehicle</th>
                                    <th>Trips</th>
                                    <th>Distance</th>
                                    <th>Fuel Eff.</th>
                                    <th>Avg Speed</th>
                                    <th>Cost/km</th>
                                    <th>Safety</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Toyota Corolla</td>
                                    <td>8</td>
                                    <td>352.4 km</td>
                                    <td>13.2 km/L</td>
                                    <td>56.8 km/h</td>
                                    <td>$0.14</td>
                                    <td>945</td>
                                </tr>
                                <tr>
                                    <td>Honda Civic</td>
                                    <td>7</td>
                                    <td>273.4 km</td>
                                    <td>11.8 km/L</td>
                                    <td>60.2 km/h</td>
                                    <td>$0.16</td>
                                    <td>895</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Driver Performance</h3>
                    </div>
                    <div class="card-body">
                        <div class="performance-radar">
                            <canvas id="performanceRadar" width="300" height="300"></canvas>
                        </div>
                        <div class="performance-legend">
                            <div class="legend-item">
                                <span class="legend-color safety"></span>
                                <span>Safety</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color efficiency"></span>
                                <span>Efficiency</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color consistency"></span>
                                <span>Consistency</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color compliance"></span>
                                <span>Compliance</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Report Generator</h3>
                </div>
                <div class="card-body">
                    <div class="report-options">
                        <div class="report-option">
                            <h4>Trip Report</h4>
                            <p>Detailed trip history with metrics</p>
                            <button class="btn btn-primary"
                                onclick="if(window.analytics) window.analytics.generateReport('daily')">
                                <i class="fas fa-file-pdf"></i> Generate PDF
                            </button>
                        </div>

                        <div class="report-option">
                            <h4>Expense Report</h4>
                            <p>Monthly expense breakdown</p>
                            <button class="btn btn-primary"
                                onclick="if(window.analytics) window.analytics.generateReport('monthly')">
                                <i class="fas fa-file-excel"></i> Generate Excel
                            </button>
                        </div>

                        <div class="report-option">
                            <h4>Maintenance Report</h4>
                            <p>Vehicle maintenance history</p>
                            <button class="btn btn-primary"
                                onclick="if(window.analytics) window.analytics.generateReport('weekly')">
                                <i class="fas fa-file-alt"></i> Generate Report
                            </button>
                        </div>

                        <div class="report-option">
                            <h4>Safety Report</h4>
                            <p>Driver safety performance</p>
                            <button class="btn btn-primary"
                                onclick="if(window.analytics) window.analytics.generateReport('monthly')">
                                <i class="fas fa-file-chart-line"></i> Generate Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Template -->
        <div id="settingsTemplate">
            <div class="page-header">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                <p>System configuration and user preferences</p>
            </div>

            <div class="settings-grid">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-user-cog"></i> Account Settings</h3>
                    </div>
                    <div class="card-body">
                        <form id="accountSettingsForm">
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" class="form-control" value="admin" readonly>
                                <small class="form-text text-muted">Username cannot be changed</small>
                            </div>

                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" class="form-control" id="userFullName" value="Mubeen Butt">
                            </div>

                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" class="form-control" id="userEmail" value="mubeen@example.com">
                            </div>

                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" class="form-control" id="userPhone" value="+92 300 1234567">
                            </div>

                            <div class="form-group">
                                <label>License Number</label>
                                <input type="text" class="form-control" id="userLicense" value="DL-123456">
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-key"></i> Security</h3>
                    </div>
                    <div class="card-body">
                        <form id="securitySettingsForm">
                            <div class="form-group">
                                <label>Current Password</label>
                                <input type="password" class="form-control" id="currentPassword">
                            </div>

                            <div class="form-group">
                                <label>New Password</label>
                                <input type="password" class="form-control" id="newPassword">
                            </div>

                            <div class="form-group">
                                <label>Confirm New Password</label>
                                <input type="password" class="form-control" id="confirmPassword">
                            </div>

                            <div class="form-group">
                                <label>Two-Factor Authentication</label>
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="twoFactorToggle">
                                    <label class="custom-control-label" for="twoFactorToggle">Enable 2FA</label>
                                </div>
                                <small class="form-text text-muted">Add an extra layer of security to your
                                    account</small>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-lock"></i> Update Security
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-bell"></i> Notifications</h3>
                    </div>
                    <div class="card-body">
                        <div class="notification-settings">
                            <div class="notification-item">
                                <div class="notification-info">
                                    <h5>Trip Alerts</h5>
                                    <p>Get notified when trips start/end</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="notification-item">
                                <div class="notification-info">
                                    <h5>Maintenance Reminders</h5>
                                    <p>Vehicle maintenance alerts</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="notification-item">
                                <div class="notification-info">
                                    <h5>Budget Alerts</h5>
                                    <p>Expense budget warnings</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="notification-item">
                                <div class="notification-info">
                                    <h5>Safety Alerts</h5>
                                    <p>Driving behavior warnings</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="notification-item">
                                <div class="notification-info">
                                    <h5>Incident Alerts</h5>
                                    <p>Accident and breakdown alerts</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="notification-item">
                                <div class="notification-info">
                                    <h5>System Updates</h5>
                                    <p>Software update notifications</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="notification-methods">
                            <h5>Notification Methods</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="notifyEmail" checked>
                                <label class="form-check-label" for="notifyEmail">Email</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="notifySMS" checked>
                                <label class="form-check-label" for="notifySMS">SMS</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="notifyPush" checked>
                                <label class="form-check-label" for="notifyPush">Push Notifications</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-car"></i> Vehicle Settings</h3>
                    </div>
                    <div class="card-body">
                        <div class="vehicle-settings">
                            <div class="form-group">
                                <label>Default Vehicle</label>
                                <select class="form-control" id="defaultVehicle">
                                    <option value="1">Toyota Corolla (ABC-123)</option>
                                    <option value="2">Honda Civic (XYZ-789)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Distance Unit</label>
                                <select class="form-control" id="distanceUnit">
                                    <option value="km">Kilometers (km)</option>
                                    <option value="mi">Miles (mi)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Fuel Unit</label>
                                <select class="form-control" id="fuelUnit">
                                    <option value="L">Liters (L)</option>
                                    <option value="gal">Gallons (gal)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Currency</label>
                                <select class="form-control" id="currency">
                                    <option value="USD">US Dollar ($)</option>
                                    <option value="EUR">Euro (‚Ç¨)</option>
                                    <option value="GBP">British Pound (¬£)</option>
                                    <option value="PKR">Pakistani Rupee (‚Ç®)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Time Zone</label>
                                <select class="form-control" id="timezone">
                                    <option value="UTC+5">UTC+5 (Pakistan Standard Time)</option>
                                    <option value="UTC-5">UTC-5 (Eastern Time)</option>
                                    <option value="UTC+0">UTC (GMT)</option>
                                    <option value="UTC+1">UTC+1 (Central European Time)</option>
                                </select>
                            </div>

                            <button class="btn btn-primary" onclick="saveVehicleSettings()">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Analytics Settings</h3>
                    </div>
                    <div class="card-body">
                        <div class="analytics-settings">
                            <div class="form-group">
                                <label>Report Frequency</label>
                                <select class="form-control" id="reportFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Auto-generate Reports</label>
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="autoReportsToggle" checked>
                                    <label class="custom-control-label" for="autoReportsToggle">Enable
                                        auto-reports</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Report Delivery</label>
                                <select class="form-control" id="reportDelivery">
                                    <option value="email">Email</option>
                                    <option value="dashboard">Dashboard Only</option>
                                    <option value="both">Both</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Data Retention Period</label>
                                <select class="form-control" id="dataRetention">
                                    <option value="30">30 days</option>
                                    <option value="90" selected>90 days</option>
                                    <option value="365">1 year</option>
                                    <option value="0">Forever</option>
                                </select>
                                <small class="form-text text-muted">How long to keep historical data</small>
                            </div>

                            <div class="form-group">
                                <label>Privacy Settings</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="shareAnonymousData" checked>
                                    <label class="form-check-label" for="shareAnonymousData">
                                        Share anonymous usage data
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="locationTracking" checked>
                                    <label class="form-check-label" for="locationTracking">
                                        Enable location tracking
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enableVision" checked>
                                    <label class="form-check-label" for="enableVision">
                                        Enable vision analytics
                                    </label>
                                </div>
                            </div>

                            <button class="btn btn-primary" onclick="saveAnalyticsSettings()">
                                <i class="fas fa-save"></i> Save Analytics Settings
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card card-wide">
                    <div class="card-header">
                        <h3><i class="fas fa-database"></i> System Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="system-info-grid">
                            <div class="info-item">
                                <span class="label">Application Version:</span>
                                <span class="value">1.2.0</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Database Version:</span>
                                <span class="value">SDMDB001</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Last Backup:</span>
                                <span class="value">2024-01-20 14:30:00</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Database Size:</span>
                                <span class="value">245 MB</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Total Drivers:</span>
                                <span class="value">15</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Total Vehicles:</span>
                                <span class="value">8</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Total Trips:</span>
                                <span class="value">156</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Total Distance:</span>
                                <span class="value">6,524 km</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Server Status:</span>
                                <span class="value connected">Connected</span>
                            </div>
                            <div class="info-item">
                                <span class="label">WebSocket Status:</span>
                                <span class="value connected">Connected</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Cache Hit Rate:</span>
                                <span class="value">92.5%</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Uptime:</span>
                                <span class="value">15 days, 6 hours</span>
                            </div>
                        </div>

                        <div class="system-actions">
                            <button class="btn btn-warning" onclick="backupDatabase()">
                                <i class="fas fa-database"></i> Backup Database
                            </button>
                            <button class="btn btn-danger" onclick="clearCache()">
                                <i class="fas fa-trash"></i> Clear Cache
                            </button>
                            <button class="btn btn-info" onclick="checkForUpdates()">
                                <i class="fas fa-sync"></i> Check for Updates
                            </button>
                            <button class="btn btn-secondary" onclick="showSystemLogs()">
                                <i class="fas fa-file-alt"></i> View Logs
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-question-circle"></i> Help & Support</h3>
                    </div>
                    <div class="card-body">
                        <div class="help-links">
                            <a href="#" class="help-link" onclick="showHelp('user_guide')">
                                <i class="fas fa-book"></i>
                                <div>
                                    <h5>User Guide</h5>
                                    <p>Complete system documentation</p>
                                </div>
                            </a>

                            <a href="#" class="help-link" onclick="showHelp('faq')">
                                <i class="fas fa-question"></i>
                                <div>
                                    <h5>FAQ</h5>
                                    <p>Frequently asked questions</p>
                                </div>
                            </a>

                            <a href="#" class="help-link" onclick="showHelp('tutorials')">
                                <i class="fas fa-play-circle"></i>
                                <div>
                                    <h5>Video Tutorials</h5>
                                    <p>Step-by-step guides</p>
                                </div>
                            </a>

                            <a href="#" class="help-link" onclick="contactSupport()">
                                <i class="fas fa-headset"></i>
                                <div>
                                    <h5>Contact Support</h5>
                                    <p>Get help from our team</p>
                                </div>
                            </a>
                        </div>

                        <div class="about-section">
                            <h5>About Smart Drive Manager</h5>
                            <p>Version 1.2.0</p>
                            <p>¬© 2024 Smart Drive Systems. All rights reserved.</p>
                            <p>Developed by Mubeen Butt - BSCS-24063</p>
                            <p>Data Structures Project</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Dashboard Template -->

        <div id="dashboardTemplate">
            <div class="dashboard-grid">
                <!-- Row 1: Camera and Quick Actions -->
                <div class="card card-wide">
                    <div class="card-header">
                        <h3><i class="fas fa-video"></i> Live Camera Feed</h3>
                        <div class="card-actions">
                            <span class="status-badge success" id="cameraStatusBadge">
                                <i class="fas fa-circle" style="font-size: 8px; animation: pulse-dot 2s infinite;"></i>
                                Active
                            </span>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Camera feed container - always active after login -->
                        <div class="video-container">
                            <div class="video-placeholder" id="noVideo" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Initializing camera...</p>
                                <p class="small">Lane detection will start automatically</p>
                            </div>
                            <img id="videoFeed" class="video-feed" style="display: block;">
                            <div class="video-overlay">
                                <div class="fps-counter" id="fpsDisplay">FPS: 0</div>
                                <div class="timestamp" id="frameTimestamp"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-play-circle"></i> Trip Control</h3>
                    </div>
                    <div class="card-body">
                        <div class="trip-controls">
                            <div class="vehicle-select">
                                <label>Select Vehicle:</label>
                                <select id="vehicleSelect" class="form-select">
                                    <option value="1">Toyota Corolla (ABC-123)</option>
                                    <option value="2">Honda Civic (XYZ-789)</option>
                                </select>
                            </div>
                            <div class="btn-group-vertical">
                                <button class="btn btn-success btn-lg" onclick="startTrip()" id="startTripBtn">
                                    <i class="fas fa-play"></i> Start Trip
                                </button>
                                <button class="btn btn-danger btn-lg" onclick="stopTrip()" id="stopTripBtn" disabled>
                                    <i class="fas fa-stop"></i> Stop Trip
                                </button>
                            </div>
                            <div class="current-trip" id="currentTripInfo" style="display: none;">
                                <h4>Active Trip</h4>
                                <p>Trip ID: <span id="activeTripId">0</span></p>
                                <p>Duration: <span id="tripDuration">00:00:00</span></p>
                                <p>Distance: <span id="tripDistance">0.00 km</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 2: Stats and Map -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-tachometer-alt"></i> Speedometer</h3>
                    </div>
                    <div class="card-body">
                        <div class="speedometer-container">
                            <canvas id="speedometer" width="250" height="250"></canvas>
                            <div class="speed-display">
                                <span id="speedValue">0</span>
                                <span class="unit">km/h</span>
                            </div>
                        </div>
                        <div class="speed-stats">
                            <div class="stat">
                                <span class="label">Avg Speed</span>
                                <span class="value" id="avgSpeed">0</span>
                            </div>
                            <div class="stat">
                                <span class="label">Max Speed</span>
                                <span class="value" id="maxSpeed">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marked-alt"></i> GPS Location</h3>
                    </div>
                    <div class="card-body">
                        <div class="gps-display">
                            <div class="coordinates">
                                <div class="coord">
                                    <span class="label">Latitude</span>
                                    <span class="value" id="gpsLat">31.5204¬∞</span>
                                </div>
                                <div class="coord">
                                    <span class="label">Longitude</span>
                                    <span class="value" id="gpsLon">74.3587¬∞</span>
                                </div>
                            </div>
                            <div class="gps-map">
                                <div id="mapPlaceholder" class="map-placeholder">
                                    <i class="fas fa-map"></i>
                                    <p>GPS Map</p>
                                    <p class="small">Real-time position tracking</p>
                                </div>
                                <!-- In production, integrate with Google Maps or Leaflet -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-exclamation-triangle"></i> Safety Events</h3>
                    </div>
                    <div class="card-body">
                        <div class="safety-events">
                            <div class="event-item">
                                <i class="fas fa-car-crash"></i>
                                <div>
                                    <span class="event-label">Harsh Braking</span>
                                    <span class="event-count" id="harshBrakeCount">0</span>
                                </div>
                            </div>
                            <div class="event-item">
                                <i class="fas fa-bolt"></i>
                                <div>
                                    <span class="event-label">Rapid Acceleration</span>
                                    <span class="event-count" id="rapidAccelCount">0</span>
                                </div>
                            </div>
                            <div class="event-item">
                                <i class="fas fa-tachometer-alt"></i>
                                <div>
                                    <span class="event-label">Speeding</span>
                                    <span class="event-count" id="speedingCount">0</span>
                                </div>
                            </div>
                            <div class="event-item">
                                <i class="fas fa-road"></i>
                                <div>
                                    <span class="event-label">Lane Departures</span>
                                    <span class="event-count" id="laneDepartureCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 3: Quick Stats -->
                <div class="card card-wide">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Quick Statistics</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <i class="fas fa-route"></i>
                                <div class="stat-content">
                                    <h4 id="totalTrips">15</h4>
                                    <p>Total Trips</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-road"></i>
                                <div class="stat-content">
                                    <h4 id="totalDistance">625.8 km</h4>
                                    <p>Total Distance</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-gas-pump"></i>
                                <div class="stat-content">
                                    <h4 id="fuelEfficiency">12.5</h4>
                                    <p>km/L</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-money-bill-wave"></i>
                                <div class="stat-content">
                                    <h4 id="totalExpenses">$2,450</h4>
                                    <p>Total Expenses</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-car"></i>
                                <div class="stat-content">
                                    <h4 id="totalVehicles">2</h4>
                                    <p>Vehicles</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-calendar-check"></i>
                                <div class="stat-content">
                                    <h4 id="incidentFreeDays">45</h4>
                                    <p>Incident-Free Days</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trips Template -->
        <div id="tripsTemplate">
            <div class="page-header">
                <h2><i class="fas fa-route"></i> Trip Management</h2>
                <p>View and manage your driving trips</p>
            </div>

            <div class="trips-controls">
                <button class="btn btn-primary" onclick="showNewTripModal()">
                    <i class="fas fa-plus"></i> New Trip
                </button>
                <div class="filter-controls">
                    <input type="date" id="tripDateFilter" class="form-control">
                    <select id="tripVehicleFilter" class="form-select">
                        <option value="">All Vehicles</option>
                        <option value="1">Toyota Corolla</option>
                        <option value="2">Honda Civic</option>
                    </select>
                    <button class="btn btn-secondary" onclick="loadTrips()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Trip History</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="data-table" id="tripsTable">
                            <thead>
                                <tr>
                                    <th>Trip ID</th>
                                    <th>Date</th>
                                    <th>Vehicle</th>
                                    <th>Distance</th>
                                    <th>Duration</th>
                                    <th>Avg Speed</th>
                                    <th>Safety Score</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Trips will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>Trip Statistics</h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-list">
                                <div class="stat-item">
                                    <span class="label">Total Trips:</span>
                                    <span class="value" id="statsTotalTrips">15</span>
                                </div>
                                <div class="stat-item">
                                    <span class="label">Total Distance:</span>
                                    <span class="value" id="statsTotalDistance">625.8 km</span>
                                </div>
                                <div class="stat-item">
                                    <span class="label">Average Speed:</span>
                                    <span class="value" id="statsAvgSpeed">58.4 km/h</span>
                                </div>
                                <div class="stat-item">
                                    <span class="label">Fuel Efficiency:</span>
                                    <span class="value" id="statsFuelEfficiency">12.5 km/L</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Trip Map</h3>
                        </div>
                        <div class="card-body">
                            <div class="trip-map-placeholder">
                                <i class="fas fa-map-marked-alt"></i>
                                <p>Trip Route Visualization</p>
                                <p class="small">GPS route map will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehicles Template -->
        <div id="vehiclesTemplate">
            <div class="page-header">
                <h2><i class="fas fa-car-side"></i> Vehicle Management</h2>
                <p>Manage your vehicles and maintenance</p>
            </div>

            <div class="vehicles-controls">
                <button class="btn btn-primary" onclick="showAddVehicleModal()">
                    <i class="fas fa-plus"></i> Add Vehicle
                </button>
                <button class="btn btn-warning" onclick="refreshMaintenanceAlerts()">
                    <i class="fas fa-bell"></i> Check Maintenance
                </button>
            </div>

            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>My Vehicles</h3>
                        </div>
                        <div class="card-body">
                            <div class="vehicles-grid" id="vehiclesGrid">
                                <!-- Vehicles will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-exclamation-circle"></i> Maintenance Alerts</h3>
                            <span class="badge badge-danger" id="alertCount">0</span>
                        </div>
                        <div class="card-body">
                            <div class="alerts-list" id="maintenanceAlerts">
                                <!-- Alerts will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Maintenance History</h3>
                </div>
                <div class="card-body">
                    <table class="data-table" id="maintenanceTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Vehicle</th>
                                <th>Type</th>
                                <th>Odometer</th>
                                <th>Service Center</th>
                                <th>Cost</th>
                                <th>Next Service</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Maintenance records will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Expenses Template -->
        <div id="expensesTemplate">
            <div class="page-header">
                <h2><i class="fas fa-money-bill-wave"></i> Expense Tracking</h2>
                <p>Track and manage your vehicle expenses</p>
            </div>

            <div class="expenses-controls">
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="showAddExpenseModal()">
                        <i class="fas fa-plus"></i> Add Expense
                    </button>
                    <button class="btn btn-success" onclick="showAddFuelExpenseModal()">
                        <i class="fas fa-gas-pump"></i> Add Fuel
                    </button>
                    <button class="btn btn-warning" onclick="showBudgetModal()">
                        <i class="fas fa-chart-pie"></i> Set Budget
                    </button>
                </div>

                <div class="filter-controls">
                    <select id="expenseMonthFilter" class="form-select">
                        <option value="0">This Month</option>
                        <option value="1">Last Month</option>
                        <option value="3">Last 3 Months</option>
                        <option value="12">This Year</option>
                    </select>
                    <select id="expenseCategoryFilter" class="form-select">
                        <option value="">All Categories</option>
                        <option value="0">Fuel</option>
                        <option value="1">Maintenance</option>
                        <option value="2">Insurance</option>
                        <option value="3">Toll</option>
                        <option value="4">Parking</option>
                        <option value="5">Other</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>Expense Summary</h3>
                        </div>
                        <div class="card-body">
                            <div class="expense-summary">
                                <div class="total-expense">
                                    <h4 id="totalExpenseAmount">$2,450.00</h4>
                                    <p>Total This Month</p>
                                </div>
                                <div class="expense-breakdown">
                                    <div class="expense-category">
                                        <span class="label">Fuel:</span>
                                        <span class="value" id="fuelExpense">$450.00</span>
                                    </div>
                                    <div class="expense-category">
                                        <span class="label">Maintenance:</span>
                                        <span class="value" id="maintenanceExpense">$1,200.00</span>
                                    </div>
                                    <div class="expense-category">
                                        <span class="label">Insurance:</span>
                                        <span class="value" id="insuranceExpense">$600.00</span>
                                    </div>
                                    <div class="expense-category">
                                        <span class="label">Other:</span>
                                        <span class="value" id="otherExpense">$200.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>Budget Status</h3>
                        </div>
                        <div class="card-body">
                            <div class="budget-status" id="budgetStatus">
                                <!-- Budget alerts will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Recent Expenses</h3>
                </div>
                <div class="card-body">
                    <table class="data-table" id="expensesTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Vehicle</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Trip</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Expenses will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Drivers Template -->
        <div id="driversTemplate">
            <div class="page-header">
                <h2><i class="fas fa-user-circle"></i> Driver Profiles</h2>
                <p>Manage driver information and behavior</p>
            </div>

            <div class="drivers-controls">
                <button class="btn btn-primary" onclick="showAddDriverModal()">
                    <i class="fas fa-user-plus"></i> Add Driver
                </button>
                <button class="btn btn-success" onclick="loadLeaderboard()">
                    <i class="fas fa-trophy"></i> View Leaderboard
                </button>
            </div>

            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>My Profile</h3>
                        </div>
                        <div class="card-body">
                            <div class="driver-profile" id="driverProfile">
                                <!-- Profile will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>Driving Behavior</h3>
                        </div>
                        <div class="card-body">
                            <div class="behavior-stats">
                                <div class="behavior-item">
                                    <span class="label">Safety Score:</span>
                                    <span class="value" id="behaviorScore">920/1000</span>
                                </div>
                                <div class="behavior-item">
                                    <span class="label">Total Distance:</span>
                                    <span class="value" id="behaviorDistance">625.8 km</span>
                                </div>
                                <div class="behavior-item">
                                    <span class="label">Harsh Braking Rate:</span>
                                    <span class="value" id="behaviorBraking">1.2/100km</span>
                                </div>
                                <div class="behavior-item">
                                    <span class="label">Fleet Rank:</span>
                                    <span class="value" id="behaviorRank">#3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Improvement Recommendations</h3>
                </div>
                <div class="card-body">
                    <div class="recommendations" id="recommendationsList">
                        <!-- Recommendations will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Driver Leaderboard</h3>
                </div>
                <div class="card-body">
                    <table class="data-table" id="leaderboardTable">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Driver</th>
                                <th>Safety Score</th>
                                <th>Total Distance</th>
                                <th>Total Trips</th>
                                <th>Avg Speed</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Leaderboard will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Incidents Template -->
        <div id="incidentsTemplate">
            <div class="page-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Incident Management</h2>
                <p>Report and track incidents & emergencies</p>
            </div>

            <div class="incidents-controls">
                <button class="btn btn-danger" onclick="showReportIncidentModal()">
                    <i class="fas fa-plus"></i> Report Incident
                </button>
                <button class="btn btn-warning" onclick="showEmergencyModal()">
                    <i class="fas fa-phone-alt"></i> Emergency Contact
                </button>
            </div>

            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>Incident Statistics</h3>
                        </div>
                        <div class="card-body">
                            <div class="incident-stats">
                                <div class="stat-item">
                                    <span class="label">Total Incidents:</span>
                                    <span class="value" id="totalIncidents">5</span>
                                </div>
                                <div class="stat-item">
                                    <span class="label">Accidents:</span>
                                    <span class="value" id="totalAccidents">2</span>
                                </div>
                                <div class="stat-item">
                                    <span class="label">Breakdowns:</span>
                                    <span class="value" id="totalBreakdowns">2</span>
                                </div>
                                <div class="stat-item">
                                    <span class="label">Violations:</span>
                                    <span class="value" id="totalViolations">1</span>
                                </div>
                                <div class="stat-item">
                                    <span class="label">Incident-Free Days:</span>
                                    <span class="value" id="incidentFree">45</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <h3>Quick Report</h3>
                        </div>
                        <div class="card-body">
                            <div class="quick-report">
                                <div class="report-type" onclick="quickReport('accident')">
                                    <i class="fas fa-car-crash"></i>
                                    <span>Accident</span>
                                </div>
                                <div class="report-type" onclick="quickReport('breakdown')">
                                    <i class="fas fa-wrench"></i>
                                    <span>Breakdown</span>
                                </div>
                                <div class="report-type" onclick="quickReport('theft')">
                                    <i class="fas fa-user-secret"></i>
                                    <span>Theft</span>
                                </div>
                                <div class="report-type" onclick="quickReport('violation')">
                                    <i class="fas fa-traffic-light"></i>
                                    <span>Violation</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Recent Incidents</h3>
                </div>
                <div class="card-body">
                    <table class="data-table" id="incidentsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Vehicle</th>
                                <th>Location</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Incidents will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Camera Template -->
        <div id="cameraTemplate">
            <div class="page-header">
                <h2><i class="fas fa-video"></i> Vision System</h2>
                <p>Advanced driver assistance and lane detection monitoring</p>
            </div>

            <div class="camera-controls">
                <div class="status-indicators">
                    <span class="status-badge success" id="visionStatusBadge">
                        <i class="fas fa-circle" style="font-size: 8px; animation: pulse-dot 2s infinite;"></i>
                        Camera Active
                    </span>
                    <span class="status-indicator" id="laneStatusIndicator">
                        <i class="fas fa-road"></i> Lane: Centered
                    </span>
                    <span class="status-indicator" id="objectStatusIndicator">
                        <i class="fas fa-eye"></i> Detection: Active
                    </span>
                </div>
                <div class="btn-group">
                    <button class="btn btn-warning btn-sm" onclick="toggleNightVision()" id="nightVisionBtn">
                        <i class="fas fa-moon"></i> Night Vision
                    </button>
                </div>
            </div>

            <div class="vision-grid">
                <div class="card card-wide">
                    <div class="card-header">
                        <h3><i class="fas fa-eye"></i> Live Lane Detection Feed</h3>
                        <div class="card-actions">
                            <span class="fps-display" id="visionFps">FPS: 0</span>
                            <span class="resolution-display">640x480</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="vision-container">
                            <div class="vision-placeholder" id="visionPlaceholder" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Initializing vision system...</p>
                            </div>
                            <img id="visionFeed" class="vision-feed" style="display: block;">
                            <div class="vision-overlay">
                                <div class="detection-box" id="laneDetection">
                                    <div class="lane-center"></div>
                                    <div class="lane-left"></div>
                                    <div class="lane-right"></div>
                                </div>
                                <div class="object-detection" id="objectDetection">
                                    <!-- Object detection boxes will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Vision Analytics</h3>
                    </div>
                    <div class="card-body">
                        <div class="analytics-stats">
                            <div class="analytics-item">
                                <span class="label">Lane Deviation:</span>
                                <span class="value" id="laneDeviation">0%</span>
                            </div>
                            <div class="analytics-item">
                                <span class="label">Objects Detected:</span>
                                <span class="value" id="objectsDetected">0</span>
                            </div>
                            <div class="analytics-item">
                                <span class="label">Driver Attention:</span>
                                <span class="value" id="driverAttention">100%</span>
                            </div>
                            <div class="analytics-item">
                                <span class="label">Drowsiness Level:</span>
                                <span class="value" id="drowsinessLevel">0%</span>
                            </div>
                        </div>
                        <div class="analytics-chart">
                            <canvas id="visionChart" width="300" height="150"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Vision Settings</h3>
                    </div>
                    <div class="card-body">
                        <div class="vision-settings">
                            <div class="setting-item">
                                <label>Lane Detection:</label>
                                <label class="switch">
                                    <input type="checkbox" id="laneDetectionToggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>Object Detection:</label>
                                <label class="switch">
                                    <input type="checkbox" id="objectDetectionToggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>Face Detection:</label>
                                <label class="switch">
                                    <input type="checkbox" id="faceDetectionToggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>Night Mode:</label>
                                <label class="switch">
                                    <input type="checkbox" id="nightModeToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>Alert Sound:</label>
                                <label class="switch">
                                    <input type="checkbox" id="alertSoundToggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Detection Log</h3>
                </div>
                <div class="card-body">
                    <div class="detection-log" id="detectionLog">
                        <div class="log-entry">
                            <span class="log-time">12:30:45</span>
                            <span class="log-type info">System started</span>
                            <span class="log-message">Vision system initialized</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="newTripModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Start New Trip</h3>
                <button class="close" onclick="closeModal('newTripModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="newTripForm">
                    <div class="form-group">
                        <label>Vehicle:</label>
                        <select id="tripVehicle" class="form-control" required>
                            <option value="">Select Vehicle</option>
                            <option value="1">Toyota Corolla (ABC-123)</option>
                            <option value="2">Honda Civic (XYZ-789)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Starting Location:</label>
                        <input type="text" id="tripStartLocation" class="form-control"
                            placeholder="Enter address or use current location" required>
                        <button type="button" class="btn btn-sm btn-secondary" onclick="getCurrentLocation()">
                            <i class="fas fa-location-arrow"></i> Use Current Location
                        </button>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Latitude:</label>
                            <input type="number" id="tripStartLat" class="form-control" step="0.000001" required>
                        </div>
                        <div class="form-group">
                            <label>Longitude:</label>
                            <input type="number" id="tripStartLon" class="form-control" step="0.000001" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Purpose:</label>
                        <input type="text" id="tripPurpose" class="form-control"
                            placeholder="Business, Personal, Delivery, etc.">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('newTripModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitNewTrip()">Start Trip</button>
            </div>
        </div>
    </div>

    <div class="modal" id="reportIncidentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Report Incident</h3>
                <button class="close" onclick="closeModal('reportIncidentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="reportIncidentForm">
                    <div class="form-group">
                        <label>Incident Type:</label>
                        <select id="incidentType" class="form-control" required>
                            <option value="">Select Type</option>
                            <option value="0">Accident</option>
                            <option value="1">Breakdown</option>
                            <option value="2">Theft</option>
                            <option value="3">Vandalism</option>
                            <option value="4">Traffic Violation</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Vehicle:</label>
                        <select id="incidentVehicle" class="form-control" required>
                            <option value="">Select Vehicle</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Latitude:</label>
                            <input type="number" id="incidentLat" class="form-control" step="0.000001" value="31.5204">
                        </div>
                        <div class="form-group">
                            <label>Longitude:</label>
                            <input type="number" id="incidentLon" class="form-control" step="0.000001" value="74.3587">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <textarea id="incidentDescription" class="form-control" rows="4"
                            placeholder="Describe the incident..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('reportIncidentModal')">Cancel</button>
                <button class="btn btn-danger" onclick="submitIncident()">Report Incident</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addVehicleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Vehicle</h3>
                <button class="close" onclick="closeModal('addVehicleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addVehicleForm">
                    <div class="form-group">
                        <label>License Plate:</label>
                        <input type="text" id="vehiclePlate" class="form-control" placeholder="ABC-123" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Make:</label>
                            <input type="text" id="vehicleMake" class="form-control" placeholder="Toyota" required>
                        </div>
                        <div class="form-group">
                            <label>Model:</label>
                            <input type="text" id="vehicleModel" class="form-control" placeholder="Corolla" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Year:</label>
                            <input type="number" id="vehicleYear" class="form-control" placeholder="2020" min="1900"
                                max="2030" required>
                        </div>
                        <div class="form-group">
                            <label>Type:</label>
                            <select id="vehicleType" class="form-control" required>
                                <option value="0">Sedan</option>
                                <option value="1">SUV</option>
                                <option value="2">Truck</option>
                                <option value="3">Van</option>
                                <option value="4">Motorcycle</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>VIN (Optional):</label>
                        <input type="text" id="vehicleVin" class="form-control"
                            placeholder="Vehicle Identification Number">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addVehicleModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitAddVehicle()">Add Vehicle</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addExpenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Expense</h3>
                <button class="close" onclick="closeModal('addExpenseModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addExpenseForm">
                    <div class="form-group">
                        <label>Vehicle:</label>
                        <select id="expenseVehicle" class="form-control" required>
                            <option value="">Select Vehicle</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category:</label>
                        <select id="expenseCategory" class="form-control" required>
                            <option value="0">Fuel</option>
                            <option value="1">Maintenance</option>
                            <option value="2">Insurance</option>
                            <option value="3">Toll</option>
                            <option value="4">Parking</option>
                            <option value="5">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Amount ($):</label>
                        <input type="number" id="expenseAmount" class="form-control" step="0.01" min="0"
                            placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <input type="text" id="expenseDescription" class="form-control"
                            placeholder="Description of expense">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addExpenseModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitAddExpense()">Add Expense</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addFuelExpenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Fuel Expense</h3>
                <button class="close" onclick="closeModal('addFuelExpenseModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addFuelExpenseForm">
                    <div class="form-group">
                        <label>Vehicle:</label>
                        <select id="fuelExpenseVehicle" class="form-control" required>
                            <option value="">Select Vehicle</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fuel Quantity (Liters):</label>
                        <input type="number" id="fuelQuantity" class="form-control" step="0.01" min="0"
                            placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label>Price per Liter ($):</label>
                        <input type="number" id="fuelPricePerUnit" class="form-control" step="0.01" min="0"
                            placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label>Gas Station:</label>
                        <input type="text" id="fuelStation" class="form-control" placeholder="Station name">
                    </div>
                    <div class="form-group">
                        <label>Trip (Optional):</label>
                        <select id="fuelTripId" class="form-control">
                            <option value="">No specific trip</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addFuelExpenseModal')">Cancel</button>
                <button class="btn btn-success" onclick="submitAddFuelExpense()">Add Fuel Expense</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addDriverModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Driver</h3>
                <button class="close" onclick="closeModal('addDriverModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addDriverForm">
                    <div class="form-group">
                        <label>Full Name:</label>
                        <input type="text" id="driverName" class="form-control" placeholder="John Doe" required>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="driverEmail" class="form-control" placeholder="john@example.com">
                    </div>
                    <div class="form-group">
                        <label>Phone:</label>
                        <input type="tel" id="driverPhone" class="form-control" placeholder="+1234567890">
                    </div>
                    <div class="form-group">
                        <label>License Number:</label>
                        <input type="text" id="driverLicense" class="form-control" placeholder="DL-123456">
                    </div>
                    <div class="form-group">
                        <label>Username:</label>
                        <input type="text" id="driverUsername" class="form-control" placeholder="johndoe" required>
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="driverPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addDriverModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitAddDriver()">Add Driver</button>
            </div>
        </div>
    </div>

    <div class="modal" id="emergencyModal">
        <div class="modal-content">
            <div class="modal-header" style="background: #dc3545; color: white;">
                <h3><i class="fas fa-exclamation-triangle"></i> Emergency Alert</h3>
                <button class="close" onclick="closeModal('emergencyModal')" style="color: white;">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center; padding: 30px;">
                <i class="fas fa-phone-alt" style="font-size: 48px; color: #dc3545; margin-bottom: 20px;"></i>
                <h4>Emergency Services</h4>
                <p>Select an emergency service to contact:</p>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                    <a href="tel:911" class="btn btn-danger btn-lg"><i class="fas fa-ambulance"></i> 911</a>
                    <a href="tel:100" class="btn btn-warning btn-lg"><i class="fas fa-car-crash"></i> Police</a>
                    <a href="tel:101" class="btn btn-primary btn-lg"><i class="fas fa-fire"></i> Fire</a>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('emergencyModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- SOS Countdown Modal -->
    <div class="modal" id="sosModal">
        <div class="modal-content sos-content">
            <div class="modal-header" style="background: #dc3545; color: white;">
                <h3><i class="fas fa-car-crash"></i> CRASH DETECTED!</h3>
            </div>
            <div class="modal-body" style="text-align: center; padding: 30px;">
                <div class="sos-animation">
                    <i class="fas fa-ambulance" style="font-size: 64px; color: #dc3545;"></i>
                </div>
                <h2 style="margin: 20px 0; color: #dc3545;">Sending SOS in</h2>
                <div id="sosCountdown" style="font-size: 80px; font-weight: bold; color: #333;">10</div>
                <p>Emergency contacts will be notified with your location.</p>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <button class="btn btn-lg btn-secondary" onclick="window.gpsManager.cancelCrashSequence()">I AM OKAY
                    (CANCEL)</button>
                <button class="btn btn-lg btn-danger" onclick="window.gpsManager.sendSOS()">SEND NOW</button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="database.js"></script>
    <script src="trip-tracker.js"></script>
    <script src="app.js"></script>
    <script src="analytics.js"></script>
    <script src="models.js"></script>
    <script src="camera.js"></script>
    <script src="gps.js"></script>
    <script src="app_websocket_udp.js"></script>
    <script src="websocket-client.js"></script>
    <script src="main.js"></script>

</body>

</html>